<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"> <!-- NOTE: Set encoding -->
  <title>Orders - Supermarket App</title> <!-- NOTE: Browser tab title -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> <!-- NOTE: Bootstrap CSS -->
</head>
<body>

  <%- include('partials/userNav', { active: 'orders' }) %> 
  <!-- NOTE: Includes the user navbar and highlights "orders" tab -->

  <main class="my-4"> <!-- NOTE: Main page container with top+bottom margin -->
    <div class="container">
      <h2>Your Orders</h2> <!-- NOTE: Page title -->

      <% if (!orders.length) { %> 
        <!-- NOTE: If user has no orders, show empty state -->
        <p>You have no orders yet.</p>
        <a href="/shopping" class="btn btn-primary">Start Shopping</a>

      <% } else { %>
        <!-- NOTE: If orders exist, display them in a table -->

        <div class="table-responsive mt-3"> <!-- NOTE: Makes table scrollable on small screens -->
          <table class="table table-bordered align-middle text-center">
            <thead class="table-light"> <!-- NOTE: Light grey header -->
              <tr>
                <th>#</th> <!-- NOTE: Serial number -->
                <th>Invoice Number</th> <!-- NOTE: Unique invoice ID -->
                <th>Order Date</th> <!-- NOTE: Date and status badge -->
                <th>Total</th> <!-- NOTE: Price of order -->
                <th>Actions</th> <!-- NOTE: "View" order link -->
              </tr>
            </thead>

            <tbody>
              <% orders.forEach(function(order, index) {  
                   // NOTE: Determine order status text & styling
                   const statusLabel = order.status || 'Pending for delivery';   // NOTE: Default if null
                   const statusKey = statusLabel.toLowerCase(); // NOTE: Lowercase for easier matching
                   let statusClass = 'status-default'; // NOTE: Default grey badge

                   if (statusKey.includes('pend')) statusClass = 'status-pending'; 
                   else if (statusKey.includes('deliver')) statusClass = 'status-pending'; 
                   else if (statusKey.includes('complete') || statusKey.includes('ship')) statusClass = 'status-complete';
                   else if (statusKey.includes('cancel')) statusClass = 'status-cancelled';
              %>

                <tr>
                  <td><%= index + 1 %></td> <!-- NOTE: Row index number -->

                  <td><%= order.invoiceNumber %></td> <!-- NOTE: Display invoice number -->

                  <td>
                    <!-- NOTE: Display order date and status pill -->
                    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                      <span><%= new Date(order.createdAt).toLocaleString() %></span> <!-- NOTE: Format timestamp -->
                      <span class="status-pill <%= statusClass %>"><%= statusLabel %></span> <!-- NOTE: Status badge -->
                    </div>
                  </td>

                  <td>$<%= Number(order.total).toFixed(2) %></td> <!-- NOTE: Ensure 2 decimal places -->

                  <td>
                    <a href="/orders/<%= order.id %>" class="btn btn-sm btn-outline-primary">View</a>
                    <!-- NOTE: Go to order detail page -->
                  </td>
                </tr>

              <% }); %>
            </tbody>

          </table>
        </div>

      <% } %>
    </div>
  </main>

  <style>
    html { scroll-behavior: smooth; } /* NOTE: Smooth scroll for anchor links */
    body { min-height: 100vh; display: flex; flex-direction: column; } /* NOTE: Make footer stick bottom */
    main { flex: 1 0 auto; } /* NOTE: Allows main to grow */
    footer { flex-shrink: 0; margin-top: auto; } /* NOTE: Footer at bottom */

    /* FOOTER COLORS */
    .app-footer { background-color: #0b2131; color: #e6edf3; }
    .app-footer a { color: #e6edf3; text-decoration: none; }
    .app-footer a:hover { text-decoration: underline; }

    .app-footer-gradient { 
      height: 4px; 
      background: linear-gradient(
        90deg,
        var(--bs-primary, #0d6efd),
        var(--bs-info, #0dcaf0),
        var(--bs-success, #198754),
        var(--bs-warning, #ffc107),
        var(--bs-danger, #dc3545)
      ); 
    }

    .app-footer-inner { font-size: .95rem; } /* NOTE: Footer text size */

    /* STATUS BADGES */
    .status-pill { 
      padding: 0.1rem 0.8rem; 
      border-radius: 999px; 
      font-size: .78rem; 
      font-weight: 600; 
      border: 1px solid transparent; 
      text-transform: capitalize;
    }

    .status-pending { background: #fff8e8; color: #b26b00; border-color: #ffe0ad; } /* NOTE: Orange badge */
    .status-complete { background: #e5f7ef; color: #0f8c4b; border-color: #b5eccf; } /* NOTE: Green badge */
    .status-cancelled { background: #feecec; color: #c53333; border-color: #f8bcbc; } /* NOTE: Red badge */
    .status-default { background: #eef2fb; color: #475467; border-color: #dce3f3; } /* NOTE: Grey badge */
  </style>

  <%- include('partials/footer') %> 
  <!-- NOTE: Includes global footer -->
</body>
</html>
